# Java 线程安全问题

当我们使用多个线程访问**同一资源**（可以是同一个变量、同一个文件、同一条记录等）的时候，若多个线程`只有读操作`，那么不会发生线程安全问题。但是如果多个线程中对资源有`读和写`的操作，就容易出现线程安全问题。

>***实际举例***
>
>开启三个窗口售票，总票数为100张。（相当于多线程）
>
>````java
>//实现方式一: 实现Runnable接口
>public class WindowTest {
>    public static void main(String[] args) {
>        SaleTicket s = new SaleTicket();
>        Thread t1 = new Thread(s);
>        Thread t2 = new Thread(s);
>        Thread t3 = new Thread(s);
>        t1.setName("窗口1");
>        t2.setName("窗口2");
>        t3.setName("窗口3");
>        t1.start();
>        t2.start();
>        t3.start();
>    }
>}
>class SaleTicket implements Runnable{
>    int ticket = 100;
>    @Override
>    public void run(){
>        while (true){
>            if(ticket > 0){
>                System.out.println(Thread.currentThread().getName()+"售票，票号为"+ticket);
>                ticket --;
>            }else{
>                break;
>            }
>        }
>    }
>}
>//输出结果
>//存在不同窗口卖出相同票号的问题
>//出现了线程的安全问题
>````
>
>````java
>//实现方式二: 继承Thread类
>public class WindowTest1 {
>    //使用继承Thread类实现
>    public static void main(String[] args) {
>        Window w1 = new Window();
>        Window w2 = new Window();
>        Window w3 = new Window();
>        w1.setName("窗口1");
>        w2.setName("窗口2");
>        w3.setName("窗口3");
>        w1.start();
>        w2.start();
>        w3.start();
>    }
>    
>}
>class Window extends Thread{
>    static int ticket = 100;
>    @Override
>    public void run() {
>        while(true){
>            if(ticket > 0){
>                System.out.println(Thread.currentThread().getName()+"售票，票号为"+ticket);
>                ticket--;
>            }else{
>                break;
>            }
>        }
>    }
>}
>//即使使用static 修饰ticket 仍然存在同票现象
>````

***归纳问题***

* 多线程卖票出现的问题

  出现了同票和错票现象

* 什么原因导致？

  线程1操作ticket的过程中，尚未结束的情况下，其他线程也参与进来，对ticket进行操作

* 如何解决？

  必须保证一个线程A在操作ticket的过程中，其他线程必须等待，直到线程A操作ticket结束以后，其他线程才能进来继续操作ticket。

* Java是如何解决线程安全问题的?

  使用线程的同步机制。`同步代码块`和`同步方法`

## 同步代码块

synchronized 关键字可以用于某个区块前面，表示只对这个区块的资源实行互斥访问。

````java
synchronized(同步监视器){
    //需要被同步的代码
}
````

* 

## 同步方法

